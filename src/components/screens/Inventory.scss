// src/components/Inventory.scss
@use 'sass:color'; // Импортируем модуль sass:color

// --- ПЕРЕМЕННЫЕ ЦВЕТОВ РЕДКОСТИ ---
// !!! Убедись, что эти переменные определены в твоем проекте или раскомментируй/настрой их здесь !!!
$rarity-color-common: #b0b0b0 !default;     // Используем значения из код1 как предпочтительные
$rarity-color-uncommon: #66bb66 !default;   // Зеленый
$rarity-color-rare: #5599ff !default;       // Синий
$rarity-color-epic: #A020F0 !default;
$rarity-color-legendary: #ffaa44 !default;  // Оранжево-золотой
$rarity-color-mythic: #cc66ff !default;     // Фиолетовый
$bright-green-arrow: #20C20E;
// ----------------------------------------------------
$rarity-colors: (
    common: $rarity-color-common,
    uncommon: $rarity-color-uncommon,
    rare: $rarity-color-rare,
    epic: $rarity-color-epic,
    legendary: $rarity-color-legendary,
    mythic: $rarity-color-mythic
    // Добавьте сюда другие редкости, если они у вас есть и для них определены переменные
) !default;

$item-popup-bg-start: #1a2a4a; // Начальный цвет градиента
$item-popup-bg-end: #0f1a30;
// --- ДОБАВЬТЕ ЭТИ ПЕРЕМЕННЫЕ ДЛЯ ЦВЕТОВ ТЕКСТА И UI ---
$text-primary-light: #ebebeb !default;    // Для заголовков, важных значений
$text-secondary-light: #c5c5c5 !default; // Для основного текста деталей (используется на строке 653)
$text-muted-light: #a0a0a0 !default;      // Для меток, субтитров, описаний (используется в .popup-description-area)
$text-dark-placeholder: #888888 !default;   // Для плейсхолдеров или неактивного текста
$golden-banner-bg: $rarity-color-legendary; // Используем ваш цвет для легендарной редкости как золотой
$golden-banner-text-dark: #422D00;     // Темный текст для золотого фона
$golden-banner-text-light: #fff;
$golden-color: #FFD700;// Цвета фона и разделителей для темных тем (примеры)
$background-element-dark: rgba(0, 0, 0, 0.2) !default; // Для фона областей, например, иконки
$divider-color-dark: rgba(120, 130, 160, 0.2) !default; // Для <hr> и разделителей border-bottom
// ---------------------------------------------------------

// --- БАЗОВЫЕ СТИЛИ СТРАНИЦЫ ---
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden; // ⛔ Запрещаем скролл всей страницы
    overscroll-behavior: contain; // ⛔ Блокируем "вытягивание" на iOS/Android
    font-family: sans-serif; // Добавлен базовый шрифт
}

// --- ОСНОВНОЙ КОНТЕЙНЕР ИНВЕНТАРЯ ---
.inventory {
    width: 100vw;
    height: 100dvh; // Используем dvh для лучшей поддержки мобильных
    background: url("/assets/main-screen-bg.png") no-repeat center center/cover;
    padding: 0;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-sizing: border-box;
    position: relative;
}

.inventory-power-display {
    display: flex;
    align-items: baseline; // Важно для красивого выравнивания текста "Power:" и больших цифр
    justify-content: center;
    padding: 8px 15px;
    margin-top: 0; // Как мы установили ранее, отступ управляется gap'ом родителя
    background-color: rgba(10, 15, 40, 0.65);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    width: 100%; 
    max-width: 280px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    text-align: center;
    flex-shrink: 0;

    .inventory-power-label { // Для текста "Power:"
        font-size: 24px;     // Текущий размер
        font-weight: bold;
        color: #FFD700;      // Текущий золотой цвет, хорошо сочетается с новым счетчиком
        margin-right: 8px;   // Отступ справа от "Power:"
        text-shadow: 0px 1px 1px rgba(0, 0, 0, 0.5);
        white-space: nowrap; // Чтобы "Power:" не переносилось, если вдруг что
    }

    .inventory-power-value { // Для цифр счетчика
        // --- ИЗМЕНЕНИЯ ---
        font-size: 24px;      // Увеличиваем размер шрифта (например, до 28px, настройте по вкусу)
        font-weight: 700;     // Оставляем жирным
        color: #FFD700;      // Делаем цифры золотыми
        line-height: 1;       // Может помочь с вертикальным выравниванием очень крупного текста
        // text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); // Опционально: легкая тень для объема
        // --- КОНЕЦ ИЗМЕНЕНИЙ ---
    }
}
// --- СТИЛИ ДЛЯ ПЕРЕКЛЮЧЕНИЯ ЛЕЙАУТОВ ---
// Базовый класс для всех лейаутов
.inventory-layout {
    position: absolute;
    top: 0;
    margin-top: max(
        70px,
        calc(35px + env(safe-area-inset-top, 0px))
      ) !important;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex; // Используем flex для управления дочерними секциями
    flex-direction: column; // Располагаем секции вертикально
    align-items: center; // Центрируем секции по горизонтали
    padding: 15px; // Отступы по краям всего лейаута
    box-sizing: border-box;
    overflow: hidden; // Обрезаем то, что может выйти за пределы
    gap: 15px; // Расстояние между секциями по умолчанию
}

// ===========================================================
// === НАЧАЛО: СТИЛИ ДЛЯ ЛЕЙАУТА 1 (Normal - Gear/Stats) ====
// ===========================================================
.inventory-layout--normal {
    margin-top: -5px; // Добавлен отступ сверху

    // ===== 1. Секция Персонажа =====
.character-section {
    flex-shrink: 0;
    width: 100%;
    max-width: 580px; // Как было у вас
    margin: 0 auto;   // Горизонтальное центрирование самого блока .character-section
                      // Вертикальный отступ теперь будет управляться gap'ом родителя .inventory-layout--normal
    background-color: rgba(20, 25, 60, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    padding: 10px;    // Существующий padding
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    box-sizing: border-box;

    // --- ДОБАВЛЕННЫЕ СТИЛИ для расположения .character-equip и .inventory-power-display ---
    display: flex;
    flex-direction: column; // Располагаем дочерние элементы (экипировка и сила) друг под другом
    align-items: center;    // Центрируем их по горизонтали
    gap: 10px; // Отступ между блоком экипировки и блоком силы (настройте по вкусу, можно 15px или 20px)
    // --- КОНЕЦ ДОБАВЛЕННЫХ СТИЛЕЙ ---

    .character-equip {
        // Стили для .character-equip остаются прежними
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5px; // Как было у вас

            .left-column, .right-column {
                display: flex;
                flex-direction: column;
                gap: 15px;
                margin-top: 10px;
            }
            .left-column { margin-right: -20px; }
            .right-column { margin-left: -20px; }

            // --- Слоты экипировки ---
            .equipment-slot {
                width: 60px; height: 60px; border-radius: 10px;
                border: 2px solid transparent; background-color: rgba(0, 0, 0, 0.25);
                display: flex; align-items: center; justify-content: center;
                cursor: pointer; transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
                position: relative;

                img { width: 42px; height: 42px; object-fit: contain; position: relative; z-index: 1; }
                .empty-slot { font-size: 22px; color: #aaa; }

                // Стили редкости для слотов
                &.rarity-common { border-color: $rarity-color-common !important; background: radial-gradient(ellipse at center, lighten($rarity-color-common, 15%), darken($rarity-color-common, 15%)) !important; }
                &.rarity-uncommon { border-color: $rarity-color-uncommon !important; background: radial-gradient(ellipse at center, lighten($rarity-color-uncommon, 10%), darken($rarity-color-uncommon, 20%)) !important; }
                &.rarity-rare { border-color: $rarity-color-rare !important; background: radial-gradient(ellipse at center, lighten($rarity-color-rare, 10%), darken($rarity-color-rare, 20%)) !important; }
                &.rarity-legendary { border-color: $rarity-color-legendary !important; background: radial-gradient(ellipse at center, lighten($rarity-color-legendary, 10%), darken($rarity-color-legendary, 20%)) !important; animation: pulse-legendary 2s infinite ease-in-out; }
                &.rarity-mythic { border-color: $rarity-color-mythic !important; background: radial-gradient(ellipse at center, lighten($rarity-color-mythic, 10%), darken($rarity-color-mythic, 20%)) !important; animation: pulse-mythic 1.8s infinite ease-in-out; }
                &.rarity-epic { 
                    border-color: $rarity-color-epic !important; 
                    background: radial-gradient(ellipse at center, lighten($rarity-color-epic, 10%), darken($rarity-color-epic, 20%)) !important;
                    // animation: pulse-epic 1.9s infinite ease-in-out; // Если нужна анимация
                }

                &:hover { border-color: #fff !important; transform: scale(1.05); }
            } // Конец .equipment-slot

            // --- Модель персонажа ---
            .character-model {
                position: relative; width: 250px; height: 250px;
                display: flex; align-items: center; justify-content: center;
                flex-shrink: 0;

                .character-viewer {
                    width: 100%; height: 100%;
                    canvas { width: 100% !important; height: 100% !important; display: block; background: transparent !important; }
                }

                // --- Контейнер стрелок ---
                .power-arrows-container {
                    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                    pointer-events: none; overflow: hidden;
                    .power-arrow {
                        position: absolute; top: 50%; left: 50%;
                        width: 25px; height: auto; object-fit: contain;
                        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
                    }
                }
            } // Конец .character-model
        } // Конец .character-equip
    } // ===== Конец .character-section =====


// ===== 2. Секция Контента (Нижняя Панель) =====
.content-section {
    flex-grow: 1; 
    width: 100%; 
    max-width: 580px; 
    margin: 0 auto;
    display: flex; 
    flex-direction: column;
    background-color: rgba(20, 25, 60, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 16px; 
    padding: 15px; // Общий padding. Табы будут "выезжать" за верхний край этого padding.
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    box-sizing: border-box; 
    
    // --- ИЗМЕНЕНИЕ: Позволяем дочерним элементам выходить за пределы ---
    overflow: visible; 
    position: relative; // Для z-index и контекста позиционирования дочерних элементов

    // Стили для корневого элемента компонента InventoryTabs 
    // (предполагаем, что он имеет класс .inventory-tabs)
    > .inventory-tabs { 
        flex-shrink: 0;
        position: relative; 
        z-index: 10; // Выше, чтобы перекрывать предыдущий блок при необходимости

        // --- ИЗМЕНЕНИЕ: Увеличиваем отрицательный отступ сверху ---
        // Это значение подбирается. Если padding-top у .content-section = 15px,
        // а высота самого блока табов с его внутренними отступами ~50-60px,
        // то margin-top: -40px или -45px заставит его значительно "выйти" вверх.
        // Например, -40px означает, что верхний край табов будет на 25px (40-15) выше 
        // верхней границы фона .content-section.
        margin-top: -40px; 
        
        margin-left: auto;
        margin-right: auto;
        // Отступ снизу до .inventory-action-buttons-wrapper или .inventory-main-area
        // Можно немного уменьшить, если табы сильно поднялись
        margin-bottom: 15px; 

        width: fit-content;
        max-width: 90%;
        
        // --- ИЗМЕНЕНИЕ: Возвращаем и адаптируем стили "подиума" ---
        // Адаптируем padding "подиума" под увеличенные кнопки
        padding: 10px 15px 8px 15px; 
        border-radius: 10px 10px 0 0; // Скругление верхних углов "подиума" (можно сделать чуть меньше, чем у кнопок)
        display: flex;
        justify-content: center;
        align-items: center; 
        gap: 0px; // Отступ между кнопками (можно уменьшить, если кнопки стали шире)

        // Стили для самих кнопок-табов
        button {
            border: none; 
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 600;

            // --- ИЗМЕНЕНИЕ: Делаем кнопки еще немного больше ---
            padding: 10px 22px; // Например, 10px вертикальный, 22px горизонтальный
            font-size: 16px;    // Увеличиваем шрифт
            border-radius: 8px 8px 0 0; // Скругление только верхних углов кнопок
            // --- КОНЕЦ ИЗМЕНЕНИЙ ---

            background: #4a5568; 
            color: #cbd5e0; 
            box-shadow: inset 0 -2px 0px rgba(0,0,0,0.1);

            &:hover:not(.active) { 
                background: #5a6578; 
                color: #fff; 
            }
            &:active:not(.active) { 
                transform: scale(0.97); 
            }

            &.active { 
                background: #FFA726; 
                color: #fff; 
                box-shadow: 0 -1px 4px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.25); 
                position: relative; 
            }
        }
    } // Конец > .inventory-tabs

    // --- Кнопки действий (прямой потомок .content-section) ---
    > .inventory-action-buttons-wrapper {
        flex-shrink: 0; 
        width: 100%; 
        max-width: 400px; 
        padding: 0 5px; 
        box-sizing: border-box;
        margin: 0 auto 15px auto; // Отступы: сверху 0 (т.к. .inventory-tabs уже дал margin-bottom), авто по бокам, 15px снизу
        display: flex; 
        justify-content: space-between; 
        align-items: center;

        .inventory-sort-button, .inventory-forge-button {
            border-radius: 8px; padding: 6px 15px; font-size: 14px; font-weight: 500;
            height: auto; box-shadow: 0 1px 3px rgba(0,0,0,0.15); border: none;
            cursor: pointer; transition: background 0.2s ease, transform 0.1s ease;
            display: inline-flex; align-items: center; justify-content: center; position: relative;
            &:active { transform: scale(0.97); }
        }
        .inventory-sort-button { background-color: #667eea; color: white; &:hover { background-color: #7f8ff5; } }
        .inventory-forge-button {
            background-color: #A1887F; color: white; &:hover { background-color: #bcaaa4; }
            .forge-indicator {
                position: absolute; top: -6px; right: -6px; width: 20px; height: 20px; font-size: 12px;
                background-color: #ef4444; color: white; font-weight: bold; border-radius: 50%;
                display: flex; align-items: center; justify-content: center; line-height: 1;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4); pointer-events: none;
            }
        }
    }

    // --- Основная область (Статы / Инвентарь) ---
    // Прямой потомок .content-section
    > .inventory-main-area {
        flex-grow: 1; // ЗАНИМАЕТ ВСЁ ОСТАВШЕЕСЯ ПРОСТРАНСТВО по высоте
        width: 100%;
        overflow: hidden; // ВАЖНО: для корректного расчета height: 100% у дочернего .inventory-gear-wrapper
        position: relative; 
        // display: flex; align-items: center; justify-content: center; // Оставляем, как было в вашем SCSS, для центрирования .stats-panel
        border-radius: 10px; 
        background-color: rgba(0, 0, 0, 0.15);

        // Если .stats-panel должен быть по центру, когда .inventory-main-area не flex:
        // .stats-panel { margin-left: auto; margin-right: auto; }
        // Но т.к. у вас было display:flex, оставляем его для .inventory-main-area, если нужно центрировать .stats-panel
         display: flex; 
         align-items: center; 
         justify-content: center;


        .stats-panel {
            background-color: transparent; border: none; box-shadow: none;
            padding: 5px; margin: 0; // margin: 0 здесь, т.к. родитель (.inventory-main-area) центрирует
            height: auto; 
            width: 100%; // Будет ограничен max-width
            max-width: 350px; 
            overflow-y: auto; 
            box-sizing: border-box;

            &::-webkit-scrollbar { width: 8px; }
            &::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
            &::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.3); border-radius: 4px; border: 2px solid transparent; background-clip: content-box; }
            &::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.5); }

            p {
                display: flex; align-items: center; margin: 12px 0; font-size: 16px;
                &::before { content: attr(data-icon); display: inline-block; font-size: 20px; width: 28px; margin-right: 10px; text-align: center; opacity: 0.9; }
                .stat-label { flex-grow: 1; color: #a0aec0; }
                .stat-value { color: #fff; font-weight: 600; margin-left: 10px; }
            }
            hr.stats-divider {
                border: none; height: 1px;
                background-color: rgba(120, 130, 160, 0.2);
                margin: 15px 0 10px 0;
            }
            .power-level-value {
                color: $rarity-color-legendary; 
                text-shadow: 0 0 5px rgba($rarity-color-legendary, 0.7);
            }
        }

        .inventory-gear-wrapper {
 height: 100%;           // Должен занимать 100% высоты .inventory-main-area
        display: flex;
        flex-direction: column;
        width: 100%;
        overflow: hidden;       // Обрезает то, что может выйти за пределы
        min-height: 0;          // <--- САМЫЙ ВАЖНЫЙ ФИКС ДЛЯ ЭТОЙ ПРОБЛЕМЫ!

            .inventory-scroll-wrapper {
               flex-grow: 1; 
            width: 100%; 
            overflow-y: auto; // Теперь это должно р// Принудительно показать скроллбар
                        flex-basis: 0;          // Хорошо добавить для flex-grow

                overflow-x: hidden;
                padding: 0px; 
                box-sizing: border-box;
                margin-bottom: 120px;

                 &::-webkit-scrollbar {
            display: none; // Можно также использовать width: 0; height: 0;
        }
        

                .inventory-items {
                    display: grid !important;
                    grid-template-columns: repeat(5, 1fr);
                    gap: 12px; 
                    padding: 0; 
                    width: 100%; 
                    height: max-content; 

                    .inventory-item {
                        width: 100%; padding-bottom: 100%; height: 0; position: relative;
                        border-radius: 8px; border: 2px solid transparent; background-color: rgba(0, 0, 0, 0.2);
                        cursor: pointer; transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;

                        img {
                            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                            max-width: 75%; max-height: 75%; width: auto; height: auto;
                            object-fit: contain; display: block;
                        }
                        .equipped-indicator {
                            position: absolute; bottom: 2px; right: 2px; width: 18px; height: 18px;
                            background-color: $rarity-color-legendary; 
                            color: #000; border-radius: 50%;
                            font-size: 11px; font-weight: bold; display: flex; align-items: center;
                            justify-content: center; line-height: 1; box-shadow: 0 0 3px rgba(0,0,0,0.5);
                            z-index: 2;
                        }
                        &.rarity-common { border-color: $rarity-color-common !important; background: radial-gradient(ellipse at center, lighten($rarity-color-common, 15%), darken($rarity-color-common, 15%)) !important; }
                        &.rarity-uncommon { border-color: $rarity-color-uncommon !important; background: radial-gradient(ellipse at center, lighten($rarity-color-uncommon, 10%), darken($rarity-color-uncommon, 20%)) !important; }
                        &.rarity-rare { border-color: $rarity-color-rare !important; background: radial-gradient(ellipse at center, lighten($rarity-color-rare, 10%), darken($rarity-color-rare, 20%)) !important; }
                        &.rarity-legendary { border-color: $rarity-color-legendary !important; background: radial-gradient(ellipse at center, lighten($rarity-color-legendary, 10%), darken($rarity-color-legendary, 20%)) !important; animation: pulse-legendary 2s infinite ease-in-out; }
                        &.rarity-mythic { border-color: $rarity-color-mythic !important; background: radial-gradient(ellipse at center, lighten($rarity-color-mythic, 10%), darken($rarity-color-mythic, 20%)) !important; animation: pulse-mythic 1.8s infinite ease-in-out; }
                        &.rarity-epic { 
                            border-color: $rarity-color-epic !important; 
                            background: radial-gradient(ellipse at center, lighten($rarity-color-epic, 10%), darken($rarity-color-epic, 20%)) !important;
                        }
                        &:hover { border-color: #fff !important; transform: scale(1.03); }
                    }
                    .empty-inventory-message {
                        grid-column: 1 / -1; text-align: center; color: #a0aec0;
                        padding: 20px; font-style: italic;
                    }
                }
            }
        }
    }
}
}

// ===========================================================
// === СТИЛИ ДЛЯ ЛЕЙАУТА 2 (Artifacts) ====
// ===========================================================
.inventory-layout--artifacts {
    margin-top: 50px;

    .inventory-tabs {
        margin-bottom: -12px; z-index: 5; position: relative;
    }

    .content-section--artifacts {
        flex-grow: 1; width: 100%; max-width: 580px; margin: 0 auto;
        display: flex; flex-direction: column; overflow: hidden;
        background: linear-gradient(180deg, rgba(50, 40, 70, 0.85), rgba(40, 30, 55, 0.9));
        border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 16px;
        padding: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); box-sizing: border-box;

        .inventory-main-area--artifacts {
            flex-grow: 1; overflow-y: auto; width: 100%;
            padding: 15px; box-sizing: border-box;

            &::-webkit-scrollbar { width: 8px; }
            &::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
            &::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.3); border-radius: 4px; border: 2px solid transparent; background-clip: content-box; }
            &::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.5); }

            // Здесь будут стили для ArtifactsPanel, если они нужны специфичные для этого контейнера
        }
    }
}

// ===========================================================
// === НАЧАЛО: ОБЩИЕ СТИЛИ ДЛЯ ТАБОВ ===
// ===========================================================
.inventory-tabs {
    flex-shrink: 0; 
    display: flex;          // Эти свойства будут применены ко всем .inventory-tabs
    justify-content: center; 
    align-items: center;    // Добавлено для вертикального центрирования кнопок, если их высота разная
    gap: 10px;              // Отступ между кнопками-табами

    // Стили для самих кнопок-табов
    button {
        background: #4a5568; 
        color: #cbd5e0; 
        border: none; 
        border-radius: 8px;
        padding: 8px 20px; 
        font-weight: 600; 
        font-size: 15px; 
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);

        &:hover { 
            background: #5a6578; 
            color: #fff; 
        }
        &:active { 
            transform: scale(0.97); 
        }
        &.active { 
            background: #FFA726; // Оранжевый для активного таба (как на скриншоте image_6c74d2.png)
            color: #fff; 
            box-shadow: 0 0 10px rgba(255, 167, 38, 0.5), 0 2px 5px rgba(0,0,0,0.3); 
        }
    }
}
// ===========================================================
// === КОНЕЦ: ОБЩИЕ СТИЛИ ДЛЯ ТАБОВ ===
// ===========================================================


// ===========================================================
// === НАЧАЛО: ОБНОВЛЕННЫЕ СТИЛИ ПОПАПА (из Код 1) ===
// ===========================================================

// Используем класс `.item-popup-backdrop` для оверлея
.item-popup-backdrop {
    // Overlay styles
    position: fixed; top: 0; left: 0; width: 100vw; height: 100dvh; // Используем dwh
    background: rgba(0, 0, 0, 0.8); // Чуть темнее фон
    display: flex; align-items: center; justify-content: center;
    z-index: 200; padding: 15px; box-sizing: border-box;

    
    // Контейнер контента попапа
    .item-popup-content {
        width: 380px; // Слегка увеличим ширину для нового макета
        max-width: 95vw;
        background: linear-gradient(160deg, $item-popup-bg-start, $item-popup-bg-end);
        border: 1px solid rgba(120, 130, 160, 0.4);
        border-radius: 12px;
        color: #e0e5f0;
        box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        position: relative;
        padding-top: 0; // Шапка имеет свой паддинг
        display: flex;
        flex-direction: column;
        max-height: 90vh; // Чуть больше высоты
         overflow: visible;

        // Кнопка закрытия X
        .popup-close-x {
        position: absolute;
        top: 10px;   // Возможно, потребуется поднять чуть выше или настроить
        right: 10px;
        background: rgba(0,0,0,0.3);
        border: 1px solid transparent;
        color: #aaa;
        font-size: 20px;
        line-height: 1;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        z-index: 1050; // Убедитесь, что z-index ВЫШЕ чем у баннеров шапки
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;

        &:hover, &:focus {
            background: rgba(0,0,0,0.5);
            color: #fff;
            border-color: rgba(255,255,255,0.3);
            transform: scale(1.1);
            outline: none;
        }
    }

    // Новый контейнер для всех элементов шапки
.custom-popup-header {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    // Этот padding-top создает "воздух" НАД следующим элементом (item-type-banner),
    // ПОСЛЕ того как item-name-banner сместится вверх.
    // Например, если item-name-banner сместится вверх на 30px, 
    // а вы хотите 10px отступа от него до item-type-banner, то padding-top ~40px.
    // Но проще управлять этим через margin-bottom у .item-name-banner или gap.
    // Оставим padding-top для позиционирования абсолютно размещенных элементов (уровень, кнопка X)
    // и для общего вида, если баннер не сильно "выезжает".
    padding: 25px 15px 15px 15px; // Верхний отступ для пространства, куда "поднимется" баннер
    gap: 8px; // Отступ между исходным местом баннера имени и баннером типа
    border-bottom: 1px solid $divider-color-dark; // Опционально
    width: 100%;
    box-sizing: border-box;
    flex-shrink: 0;
}

.item-name-banner {
    display: inline-block;
    padding: 5px 1px;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    font-weight: 700;
    text-align: center;
    // Усилим тень для эффекта "отрыва" от фона
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.45); 
    position: relative; 
   box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5); // Более выраженная тень для "отрыва"
    z-index: 3; // Должен быть выше фона/рамки .custom-popup-header, но ниже кнопки X
    max-width: 70%;

    // --- ЭФФЕКТ "НАВИСАНИЯ" ---
    // Смещаем баннер вверх. Величина смещения зависит от того, насколько он должен "торчать".
    // Если высота баннера с паддингами около 40-45px, и вы хотите, чтобы он наполовину (20-22px)
    // выступал над верхней границей .item-popup-content (которая теперь не имеет своего padding-top),
    // то смещение должно быть примерно таким.
    // transform: translateY(-22px); // Сдвигает баннер вверх на 22px

    // Альтернатива с margin-top (сильнее влияет на поток):
    margin-top: -50px; // Подберите это значение. Например, половина высоты баннера.
                       // Это поднимет баннер.
    
    // Чтобы следующий элемент (.item-type-banner) не подлез под смещенный баннер слишком сильно,
    // можно добавить margin-bottom к .item-name-banner или настроить gap на .custom-popup-header.
    // Так как margin-top сдвигает и поток, gap на .custom-popup-header будет отсчитываться от нового положения.
    // Возможно, gap уже будет достаточным. Если нет:

    // Применение фона по редкости остается как было
    @each $rarity, $color in $rarity-colors {
        &.rarity-bg-#{$rarity} {
            background-color: $color;
            @if (lightness($color) > 65%) {
                color: #2c3e50;
            } @else {
                color: white;
            }
        }
    }

        // Опционально: для текстового индикатора редкости внутри баннера
        .rarity-text-indicator {
            display: block;
            font-size: 11px;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 3px;
            @each $rarity, $color in $rarity-colors {
                &.rarity-#{$rarity} {
                    @if (lightness($color) > 65%) { color: darken($color, 40%); }
                    @else { color: lighten($color, 40%); }
                }
            }
        }
    }

    // Баннер с типом предмета
    .item-type-banner {
        display: inline-block;
        background-color: $golden-banner-bg;
        color: $golden-banner-text-dark;
        padding: 6px 18px;
        border-radius: 6px;
        font-size: 18px;
        font-weight: 500;
        text-transform: capitalize;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    // Баннер с текущим уровнем
    .current-level-banner {
        position: absolute;
        top: 5px;    // Отступ сверху (под кнопкой X или рядом)
        left: 1px;   // Отступ слева
        background-color: $golden-banner-bg;
        color: $golden-banner-text-dark;
        padding: 5px 12px;
        border-radius: 6px;
        font-size: 18px;
        font-weight: 600;
        z-index: 5; // Выше основного контента шапки, но ниже кнопки X
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        

        span { display: block; }
    }

        // 2. Основное тело попапа
.popup-body {
    padding: 15px 20px; // Внешние отступы тела попапа
    // overflow-y: auto; // Если контент может стать очень длинным

    // Новый главный вертикальный контейнер для блоков контента
    .popup-content-stack {
        display: flex;
        flex-direction: column;
        align-items: center; // Центрируем блоки контента (строки), если они не на всю ширину
        gap: 18px; // Вертикальный отступ между "этажами"
        width: 100%;
        max-width: 380px; // Максимальная ширина всего стека контента, можно настроить
        margin: 0 auto;   // Центрирует сам стек, если .popup-body шире
    }

    // --- ЭТАЖ 1: Иконка и Описание ---
    .icon-description-row {
        display: flex;
        flex-direction: row;   // Иконка слева, описание справа
        align-items: flex-start; // Выравнивание по верху
        gap: 15px;             // Отступ между иконкой и описанием
        width: 100%;           // Занимает всю ширину .popup-content-stack

        .icon-column { // Обертка для иконки
            flex: 0 0 90px; // Фиксированная ширина для области иконки

           .popup-icon-area {
    width: 90px;
    height: 90px;
    padding: 6px; // Оставляем отступы, чтобы иконка не прилипала к краям
    // background-color: $background-element-dark; // Этот общий фон будет переопределен ниже для каждой редкости
    border-radius: 6px;
    border: 2px solid transparent; // Базовая рамка, цвет которой уже меняется в зависимости от редкости
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;

    @each $rarity, $color in $rarity-colors {
        &.rarity-#{$rarity} {
            border-color: $color; // Рамка уже красится в цвет редкости

            // --- НОВЫЙ ФОН НА ОСНОВЕ ЦВЕТА РЕДКОСТИ ---
            // Используем радиальный градиент, похожий на тот, что у вас в Inventory.scss для слотов
            background: radial-gradient(ellipse at center, lighten($color, 15%), darken($color, 20%));

            // --- АЛЬТЕРНАТИВНЫЕ ВАРИАНТЫ ФОНА (если градиент не понравится): ---
            // 1. Сплошной цвет редкости (как вы изначально просили):
            // background-color: $color;

            // 2. Полупрозрачный цвет редкости (поверх существующего темного фона, если он есть у родителя):
            // background-color: rgba($color, 0.3); // Настройте прозрачность (0.3 = 30%)

            // 3. Затемненный сплошной цвет редкости:
            // background-color: darken($color, 30%); // Настройте степень затемнения
        }
    }

    .popup-icon { // Стили для самого изображения внутри .popup-icon-area
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        // image-rendering: pixelated; // если у вас пиксель-арт
    }
}
        }

        .description-column { // Обертка для описания
            flex: 1; // Занимает оставшееся пространство рядом с иконкой
            min-width: 0; // Для предотвращения проблем с переполнением flex-элементов

            .popup-description-area { // Стили для самого блока описания
                    // --- НОВЫЕ СТИЛИ ДЛЯ ФОНА И ОФОРМЛЕНИЯ БЛОКА ---
                    background-color: rgba(0, 0, 0, 0.15); // Пример фона, такой же как мы обсуждали для блока статов
                                                          // Можете выбрать другой, например, чуть светлее или темнее основного фона попапа
                    padding: 12px 15px;                   // Внутренние отступы для текста описания
                    border-radius: 6px;                   // Скругление углов блока
                    // border: 1px solid rgba(120, 130, 160, 0.1); // Опционально: очень тонкая рамка
                    width: 100%;                          // Занимает всю ширину родителя (.description-column)
                    box-sizing: border-box;
                    // --- КОНЕЦ НОВЫХ СТИЛЕЙ ---

                    // Существующие или предлагаемые стили для текста описания:
                    font-size: 13px;
                    line-height: 1.5;
                    color: $text-secondary-light; // Используем основной цвет текста для лучшей читаемости на фоне
                                                 // (вместо $text-muted-light, если он был слишком тусклым)
                    
                    p {
                        margin: 0; // Убираем стандартные отступы параграфа
                    }
                }
    }
      }

     .stats-block {
        background-color: rgba(0, 0, 0, 0.15); // Пример: темный полупрозрачный фон
        padding: 15px;                         // Внутренние отступы блока
        border-radius: 8px;                     // Скругление углов (по желанию)
        margin-bottom: 5px;                    // Отступ снизу, чтобы отделить от следующего блока (например, бонусов сета)
        width: 100%;                           // Занимает всю ширину .popup-content-stack
        box-sizing: border-box; 

.stats-comparison-table {
    display: grid;
    grid-template-columns: minmax(100px, 1.6fr) 1fr auto 1fr; // Название | Текущее | Стрелка | Следующее
    column-gap: 8px;
    row-gap: 5px;
    font-size: 13px;
    width: 100%;
    align-items: center;

    .stat-cell, .stat-name-cell, .current-value-cell, .arrow-cell, .next-value-cell {
        padding: 3px 0;
        display: flex;
        align-items: center;
    }

    .stat-name-cell {
        justify-content: flex-start; // Названия статов остаются слева
    }

    .current-value-cell {
        justify-content: center;   // --- ИЗМЕНЕНИЕ: ВСЕ текущие значения по центру ---
        font-weight: 700;
        color: $text-primary-light;
        // Класс .is-level-value больше не нужен для специального выравнивания здесь
    }

    .arrow-cell {
        justify-content: center;   // Стрелка остается по центру своей колонки
        color: $bright-green-arrow;
        font-weight: 700;
    }

    .next-value-cell {
        justify-content: center;  // --- ИЗМЕНЕНИЕ: ВСЕ следующие значения по центру ---
        font-weight: 700;

        // Класс .is-level-value больше не нужен для специального выравнивания здесь

        &.has-value { // Если есть реальное следующее значение (не "-" или "Макс.")
            color: $bright-green-arrow;
        }
        &.no-value { // Если значение "-", например, стат не улучшается дальше
            color: $text-primary-light; // Таким же цветом, как текущее значение, или $text-muted-light
        }
        &.no-upgrade { // Для отображения "Макс." на строке Уровня
            color: $text-muted-light;
            font-weight: 500; // Обычный вес для "Макс."
        }
    }
}
     }

    // --- ЭТАЖ 3: Бонус Комплекта ---
    .popup-set-bonus-area {
        width: 100%;
        max-width: 340px; // Совпадает с таблицей для выравнивания
        margin: 0 auto;   // Центрирование
        font-size: 13px;
        line-height: 1.5;
        color: $text-muted-light;
        h4 {
            font-size: 14px;
            font-weight: 600;
            color: $text-secondary-light;
            margin: 0 0 6px 0;
        }
        p { margin: 0; &:not(:last-child) { margin-bottom: 5px; } }
    }

    // --- Разделители ---
    // Предполагается, что <hr class="popup-divider content-divider" /> будет вставляться
    // в JSX/HTML между "этажами" внутри .popup-content-stack
    .popup-divider {
        border: none;
        height: 1px;
        background-color: $divider-color-dark;
        // margin: 8px 0; // Базовый отступ, если разделитель используется вне стека

        // Если разделитель является прямым потомком .popup-content-stack,
        // то gap у .popup-content-stack уже обеспечивает отступы.
        // Если <hr /> добавляется как отдельный элемент, ему могут понадобиться свои margin.
        // Для разделителей МЕЖДУ блоками в .popup-content-stack, их собственные margin могут быть не нужны
        // или должны быть скорректированы, так как .popup-content-stack уже имеет 'gap'.

        // Этот вариант стилей для <hr /> который будет помещен как дочерний элемент в .popup-content-stack
        &.content-divider {
            width: 100%;
            // max-width: 360px; // Задаем максимальную ширину, если нужно, чтобы он был чуть уже контента
                               // Если align-items: center у родителя, он будет центрирован.
                               // Если .popup-content-stack имеет max-width: 380px,
                               // то этот divider будет на всю его ширину.
            margin: 0; // Убираем margin, если gap родителя достаточен
                       // или оставляем margin: 8px 0 (или меньше) если нужен дополнительный отступ от gap
                       // В "изменениях" было margin: 8px 0; и gap: 18px; Это значит, что отступы суммировались бы
                       // или margin разделителя должен быть основным, а gap: 0.
                       // Я предполагаю, что gap: 18px в .popup-content-stack является основным,
                       // а разделитель просто линия без доп. отступов.
        }
        &.thin {
           // margin: 4px 0; // Если нужен меньший отступ для тонкого разделителя
           // Этот модификатор может регулировать `height` или `background-color` если нужно
        }
    }
}
        // --- Конец стилей Правой Колонки ---

        // 3. Футер с кнопками
.popup-buttons {
    padding: 12px;
    border-top: 1px solid rgba(120, 130, 160, 0.3);
    border-radius: 0 0 11px 11px;

    // --- ДВЕ СТРОКИ (одна группа над другой) ---
    display: flex;
    flex-direction: column; // Располагаем дочерние группы (.upgrade-action-group, .action-button-row) в столбец
    align-items: center;    // Центрируем эти группы-строки по горизонтали
    gap: 12px;              // Отступ между первой и второй строкой (группами)

    // Общие стили для групп, которые теперь выступают в роли "строк"
    .upgrade-action-group,
    .action-button-row,
    .button-group-placeholder {
        width: 90%; // Каждая группа-строка занимает большую часть ширины попапа
        max-width: 320px; // Максимальная ширина для контента в строке
        display: flex;
        flex-direction: column; // Элементы внутри каждой группы также располагаются в столбец
        align-items: stretch;   // Растягиваем элементы внутри группы на всю ее ширину
        gap: 8px; // Отступ между элементами внутри группы (например, между кнопкой улучшения и панелью валюты)
    }

    // Заглушка для первой строки (группы улучшения), если предмет не улучшаемый
    .button-group-placeholder {
        // Примерная высота группы улучшения (кнопка ~50px + панель ~30px + gap ~8px)
        min-height: 88px;
        // Можно также сделать ее прозрачной или с легким фоном для отладки
        // background-color: rgba(255,255,255,0.05);
    }

.button-upgrade {
    width: 100%;
    background: linear-gradient(to bottom, hsl(195, 70%, 60%), hsl(195, 70%, 45%));
    border: 1px solid hsl(195, 70%, 40%);
    color: white;
    padding: 6px 10px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    line-height: 1.25;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    min-height: 50px;

    &:hover:not(:disabled) {
        background: linear-gradient(to bottom, hsl(195, 70%, 65%), hsl(195, 70%, 50%));
    }
    &:disabled {
        background: linear-gradient(to bottom, #777, #555) !important;
        border-color: #444 !important;
        color: #aaa !important;
        cursor: default;
        opacity: 0.8;
    }

    .upgrade-action-text { // Стили для основного текста кнопки ("Улучшить" / "Макс. Уровень")
        font-size: 14px;
        font-weight: bold;
        // Если нужно, можно добавить margin-bottom, если между текстом и стоимостью нужен больший отступ
        // margin-bottom: 2px; 
    }

    // Удаляем или заменяем старый .upgrade-cost-text, если он был:
    // .upgrade-cost-text { /* ...старые стили... */ }

    // --- НОВЫЕ СТИЛИ для блока стоимости с иконками ---
    .upgrade-cost-display { 
        font-size: 12px;       // Размер шрифта для строки стоимости
        opacity: 0.95;         // Немного прозрачности, как вы и хотели
        white-space: nowrap;
        margin-top: 3px;       // Отступ от основного текста кнопки
        display: flex;         // Для расположения нескольких валют (золото/алмазы) в ряд
        align-items: center;
        justify-content: center; // Центрируем, если несколько валют
        gap: 8px;              // Отступ между стоимостью золота и алмазов, если оба есть

        .cost-item { // Общий контейнер для числа и иконки ОДНОЙ валюты
            display: inline-flex; // Число и иконка в одну строку
            align-items: center;
            gap: 3px;          // Отступ между числом и иконкой

            span { // Стили для ЧИСЛА стоимости
                font-weight: 600; // Можно сделать цифры пожирнее
            }
        }

        .cost-gold {
            span { // Стили для ЧИСЛА стоимости золота
                color: $golden-color; // --- ПРИМЕНЯЕМ ЗОЛОТОЙ ЦВЕТ ---
            }
        }

        .cost-diamonds {
            span { // Стили для ЧИСЛА стоимости алмазов
                // color: #85D2F2; // Пример: можно задать свой цвет для алмазов
            }
        }

        .cost-icon { // Стили для тегов <img> иконок
            width: 1em;  // Размер иконки будет ~12px, если font-size у .upgrade-cost-display = 12px
            height: 1em;
            // vertical-align: middle; // Обычно не нужен, если родитель .cost-item это inline-flex с align-items: center
        }

        .cost-info-text { // Для текста "Бесплатно" или "N/A"
            color: white; // Или другой цвет по вашему выбору
            opacity: 0.8;
        }
    }
    // --- КОНЕЦ НОВЫХ СТИЛЕЙ для блока стоимости ---
}

    // --- ИЗМЕНЕНИЕ СТИЛЕЙ для Панели с валютой игрока ---
    .player-currency-panel {
        width: 100%; // Занимает всю ширину родительской группы .upgrade-action-group
        background-color: rgba(0, 0, 0, 0.25); // Отдельный фон, например, полупрозрачный темный
        color: #e0e5f0;
        padding: 8px 10px; // Немного увеличим вертикальный padding для баланса
        border: 1px solid rgba(120, 130, 160, 0.25); // Тонкая рамка
        border-radius: 8px; // Все углы скруглены
        box-sizing: border-box;
        font-size: 12px; // Шрифт чуть крупнее для отдельной панели
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px; // Немного увеличим отступ между элементами
        min-height: 30px; // Минимальная высота панели
        // box-shadow: inset 0 1px 1px rgba(0,0,0,0.1); // Можно добавить внутреннюю тень
        .currency-display {
        display: inline-flex; // Для расположения текста и иконки в ряд
        align-items: center;
        gap: 4px; // Отступ между текстом и иконкой
    }

    .currency-icon {
        width: 14px;
        height: 14px;
        // vertical-align: middle; // Если не используется flex
    }

    .currency-separator {
        margin: 0 2px; // Небольшие отступы для разделителя
    }
}

    // Стили для второй строки (кнопки действия)
    .action-button-row {
        // width, max-width, display, flex-direction, align-items, gap уже заданы выше

        button.button-action {
            width: 100%; // Кнопка занимает всю ширину .action-button-row
            padding: 10px 15px;
            font-size: 14px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            box-sizing: border-box;
            border-style: solid;
            border-width: 1px;

            &:disabled {
                background: linear-gradient(to bottom, #777, #555) !important;
                border-color: #444 !important;
                color: #aaa !important;
                cursor: default;
                opacity: 0.8;
            }
        }

        .button-equip {
            background: linear-gradient(to bottom, #5cb85c, #449d44);
            border-color: #398439;
            color: white;
            &:hover:not(:disabled) {
                background: linear-gradient(to bottom, #6fca6f, #55b055);
            }
        }
        .button-unequip {
            background: linear-gradient(to bottom, #d9534f, #c9302c);
            border-color: #ac2925;
            color: white;
            &:hover:not(:disabled) {
                background: linear-gradient(to bottom, #e0635f, #d43f3a);
            }
        }
        .button-change {
            background: linear-gradient(to bottom, #f0ad4e, #ec971f);
            border-color: #d58512;
            color: white;
            &:hover:not(:disabled) {
                background: linear-gradient(to bottom, #f3bd6a, #f0a73e);
            }
        }
    }
}
}
}

// ===========================================================
// === КОНЕЦ: ОБНОВЛЕННЫЕ СТИЛИ ПОПАПА ===
// ===========================================================

// --- АНИМАЦИИ (Оставляем из предыдущего кода для слотов/предметов) ---
@keyframes pulse-legendary {
    0% { box-shadow: 0 0 8px 2px rgba(color.adjust($rarity-color-legendary, $alpha: -0.4), 0.6), inset 0 0 5px 1px rgba(lighten($rarity-color-legendary, 20%), 0.4); border-color: $rarity-color-legendary;}
    50% { box-shadow: 0 0 12px 4px rgba(color.adjust($rarity-color-legendary, $alpha: -0.2), 0.8), inset 0 0 7px 2px rgba(lighten($rarity-color-legendary, 20%), 0.6); border-color: lighten($rarity-color-legendary, 15%);}
    100% { box-shadow: 0 0 8px 2px rgba(color.adjust($rarity-color-legendary, $alpha: -0.4), 0.6), inset 0 0 5px 1px rgba(lighten($rarity-color-legendary, 20%), 0.4); border-color: $rarity-color-legendary;}
}

@keyframes pulse-mythic {
    0% { box-shadow: 0 0 10px 3px rgba(color.adjust($rarity-color-mythic, $alpha: -0.3), 0.7), inset 0 0 6px 1px rgba(lighten($rarity-color-mythic, 20%), 0.5); border-color: $rarity-color-mythic;}
    50% { box-shadow: 0 0 15px 5px rgba(color.adjust($rarity-color-mythic, $alpha: -0.1), 0.9), inset 0 0 8px 2px rgba(lighten($rarity-color-mythic, 20%), 0.7); border-color: lighten($rarity-color-mythic, 15%);}
    100% { box-shadow: 0 0 10px 3px rgba(color.adjust($rarity-color-mythic, $alpha: -0.3), 0.7), inset 0 0 6px 1px rgba(lighten($rarity-color-mythic, 20%), 0.5); border-color: $rarity-color-mythic;}
}